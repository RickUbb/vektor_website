---
title: "Servidor MCP Supabase"
description: "Servidor Model Context Protocol (MCP) especializado para anÃ¡lisis empresarial de ventas de combustibles Trans Esmeraldas S.A. (TEISA) usando Supabase."
---

![MCP Supabase Server](./img/mcp_server_supabase_raiz.png)
:::info
## ğŸ“‹ Ãndice
:::
- [CaracterÃ­sticas](#caracterÃ­sticas)
- [Requisitos previos](#requisitos-previos)
- [InstalaciÃ³n y ejecuciÃ³n local](#instalaciÃ³n-y-ejecuciÃ³n-local)
- [IntegraciÃ³n con clientes MCP](#integraciÃ³n-con-clientes-mcp)
- [Herramientas MCP disponibles](#herramientas-mcp-disponibles)
- [Endpoints REST y documentaciÃ³n](#endpoints-rest-y-documentaciÃ³n)
- [Variables de entorno](#variables-de-entorno)
- [Docker](#docker)
- [Notas importantes](#notas-importantes)
- [Dependencias](#dependencias)
:::info
## âœ¨ CaracterÃ­sticas
:::
- **AnÃ¡lisis especializado TEISA**: Herramientas MCP diseÃ±adas para ventas de combustibles en estaciones TEISA 1 y TEISA 2
- **Protocolo MCP completo**: Server-Sent Events (SSE) para integraciÃ³n con asistentes de IA
- **API REST documentada**: Endpoints con Swagger UI y ReDoc
- **Consultas empresariales avanzadas**: AnÃ¡lisis de demanda, comparaciÃ³n de estaciones y ranking de combustibles
- **GestiÃ³n de ~3,000 registros**: Procesamiento eficiente de datos de ventas
- **Docker-ready**: Imagen lista para producciÃ³n
:::info
## ğŸ”§ Requisitos previos
:::
- Python 3.13 o superior
- uv (gestor de entornos virtuales)
- Cuenta y proyecto activo en Supabase
- Variables de entorno: `SUPABASE_URL` y `SUPABASE_SERVICE_KEY`
:::info
## ğŸš€ InstalaciÃ³n y ejecuciÃ³n local
:::
### 1. Instalar uv (Gestor de entornos para Python)

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
uv --version
```

### 2. Clonar y configurar el proyecto

```bash
git clone https://github.com/snayderstone/mcp_supabase.git
cd mcp_supabase
uv venv .venv
source .venv/bin/activate
uv sync
```

### 3. Configurar variables de entorno

```bash
echo "SUPABASE_URL=tu_url_de_supabase" > .env
echo "SUPABASE_SERVICE_KEY=tu_clave_de_servicio" >> .env
# o export directamente
export SUPABASE_URL="tu_url_de_supabase"
export SUPABASE_SERVICE_KEY="tu_clave_de_servicio"
```

### 4. Ejecutar el servidor

```bash
uv run server.py          # SSE (MCP)
uv run server.py --api    # REST API
```

DespuÃ©s verÃ¡s:
```
ğŸš€ Iniciando TEISA Supabase MCP Server...
ğŸ“¡ Servidor disponible en: http://0.0.0.0:8083
ğŸ”— Endpoint SSE: http://0.0.0.0:8083/sse
ğŸ“š DocumentaciÃ³n: http://0.0.0.0:8083/docs
â›½ Cargadas 5 herramientas TEISA
```
:::info
## ğŸ”Œ IntegraciÃ³n con clientes MCP
:::
### Claude Desktop

```json
{
  "mcpServers": {
    "supabase-teisa": {
      "command": "npx",
      "args": ["-y","supergateway","--sse","http://localhost:8083/sse"],
      "disabled": false,
      "autoApprove": []
    }
  }
}
```

### Visual Studio Code

```bash
mkdir .vscode && touch .vscode/mcp.json
```
```json
{
  "servers": {"mcp_supabase_teisa": {"url":"http://localhost:8083/sse"}}
}
```

Usa `Ctrl+Shift+P` â†’ "MCP: Connect to Server" â†’ `mcp_supabase_teisa` y luego "Use Tool" â†’ cualquiera de las herramientas.
:::info
## ğŸ› ï¸ Herramientas MCP disponibles
:::
1. **get_table_rows**: Filas de cualquier tabla (`table`, `limit`)
2. **get_monthly_fuel_sales**: Ventas por mes (`year`, `month`)
3. **get_most_sold_fuel_type**: Ranking de combustible mÃ¡s vendido
4. **get_peak_demand_period**: Periodos de mayor demanda
5. **get_station_comparison**: ComparaciÃ³n TEISA 1 vs TEISA 2
:::info
## ğŸ“– Endpoints REST y documentaciÃ³n
:::
- **Swagger UI**
  ![Swagger Docs](./img/mcp_server_supabase_docs.png)
- **ReDoc** 
  ![ReDoc](./img/mcp_server_supabase_redoc.png)

### Ejemplo REST

```http
GET /rows?table=tbl_ventas_teisa&limit=5
```

```json
[
  {"id":1,"Fecha":"03-15-2024","EstaciÃ³n":"TEISA 1","Tipo_Combustible":"Gasolina Extra","Litros_Vendidos":45.50,"Total_Venta":85.30}
]
```
:::info
## ğŸ”‘ Variables de entorno
:::
| Variable               | DescripciÃ³n                   | Ejemplo                                |
|------------------------|-------------------------------|----------------------------------------|
| `SUPABASE_URL`         | URL de tu proyecto Supabase   | `https://tu-proyecto.supabase.co`     |
| `SUPABASE_SERVICE_KEY` | Service role key de Supabase  | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` |
:::info
## ğŸ” Pruebas con MCP Inspector
:::
```bash
npx -y @modelcontextprotocol/inspector
```
![MCP Inspector](./img/mcp_inspector.png)
:::caution
## âš ï¸ Notas importantes
:::
> **Formato Fecha**: Si `Fecha` estÃ¡ en `MM-DD-YYYY`, no cambies o ajusta `get_monthly_fuel_sales` para `YYYY-MM-DD`.

> **Seguridad**: Nunca subas `.env`, usa siempre `SERVICE_KEY`, no `ANON_KEY`.

> **Rendimiento**: Usa `limit` y agregaciones para manejar ~3,000 registros.
:::info
## ğŸ“š Dependencias
:::
- fastapi
- mcp[cli]
- supabase
- httpx
- pandas
- uvicorn

Consulta `pyproject.toml` para mÃ¡s detalles.
